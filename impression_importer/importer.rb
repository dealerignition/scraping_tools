require 'base64'
require 'csv'
require 'nestful'

dealer_conversion_table = {
                           727 => 23,
                           967 => 24,
                           1145 => 25,
                           1147 => 26,
                           1261 => 27,
                           1295 => 28,
                           193 => 200,
                           312 => 201,
                           1441 => 199,
                           159 => 17,
                           171 => 18,
                           487 => 19,
                           493 => 20,
                           602 => 21,
                           1513 => 29,
                           1518 => 30,
                           1545 => 31,
                           129 => 16,
                           721 => 22,
                           414 => 12,
                           1601 => 32,
                           1774 => 33,
                           1863 => 34,
                           2118 => 35,
                           253 => 36,
                           323 => 37,
                           689 => 38,
                           1133 => 40,
                           1163 => 41,
                           1471 => 42,
                           1557 => 43,
                           1864 => 44,
                           242 => 45,
                           506 => 46,
                           1409 => 47,
                           2710 => 48,
                           326 => 202,
                           3798 => 50,
                           3799 => 51,
                           3800 => 52,
                           3801 => 53,
                           921 => 54,
                           343 => 203,
                           364 => 204,
                           402 => 205,
                           128 => 59,
                           137 => 60,
                           914 => 39,
                           2119 => 15,
                           110 => 55,
                           465 => 206,
                           158 => 61,
                           164 => 62,
                           235 => 63,
                           243 => 64,
                           252 => 65,
                           254 => 66,
                           275 => 67,
                           280 => 68,
                           294 => 69,
                           303 => 70,
                           309 => 71,
                           359 => 72,
                           379 => 73,
                           486 => 207,
                           443 => 75,
                           444 => 76,
                           454 => 77,
                           473 => 78,
                           490 => 79,
                           508 => 80,
                           524 => 81,
                           565 => 82,
                           566 => 83,
                           577 => 84,
                           586 => 85,
                           654 => 87,
                           655 => 88,
                           681 => 89,
                           704 => 90,
                           705 => 91,
                           648 => 86,
                           800 => 92,
                           807 => 93,
                           840 => 94,
                           841 => 95,
                           864 => 96,
                           522 => 208,
                           552 => 209,
                           614 => 210,
                           667 => 211,
                           669 => 212,
                           823 => 213,
                           946 => 214,
                           1039 => 215,
                           1444 => 216,
                           1476 => 217,
                           1587 => 218,
                           2115 => 219,
                           598 => 220,
                           780 => 221,
                           857 => 222,
                           1743 => 223,
                           1820 => 224,
                           1873 => 225,
                           631 => 226,
                           168 => 229,
                           175 => 230,
                           215 => 231,
                           234 => 232,
                           395 => 233,
                           2120 => 228,
                           3792 => 49,
                           440 => 74,
                           886 => 97,
                           891 => 98,
                           899 => 99,
                           903 => 100,
                           960 => 101,
                           979 => 102,
                           981 => 103,
                           994 => 104,
                           998 => 105,
                           1008 => 106,
                           1021 => 107,
                           1030 => 108,
                           1038 => 109,
                           1055 => 110,
                           448 => 234,
                           1072 => 112,
                           1088 => 113,
                           1089 => 114,
                           1092 => 115,
                           1137 => 116,
                           1168 => 117,
                           1184 => 118,
                           1186 => 119,
                           1196 => 120,
                           1199 => 121,
                           1201 => 122,
                           1254 => 123,
                           1269 => 124,
                           1318 => 125,
                           1337 => 126,
                           1353 => 127,
                           1368 => 128,
                           1062 => 111,
                           1283 => 14,
                           644 => 13,
                           223 => 56,
                           904 => 57,
                           1384 => 58,
                           456 => 235,
                           476 => 236,
                           514 => 237,
                           556 => 238,
                           588 => 239,
                           649 => 240,
                           652 => 241,
                           661 => 242,
                           726 => 243,
                           766 => 244,
                           906 => 245,
                           972 => 246,
                           984 => 247,
                           996 => 248,
                           1043 => 249,
                           1177 => 250,
                           1317 => 251,
                           1327 => 252,
                           1606 => 253,
                           1758 => 254,
                           1807 => 255,
                           1851 => 256,
                           1862 => 257,
                           1920 => 258,
                           1952 => 260,
                           1986 => 261,
                           2609 => 262,
                           3803 => 263,
                           3804 => 264,
                           3805 => 265,
                           660 => 266,
                           805 => 267,
                           1721 => 268,
                           942 => 227,
                           1947 => 259,
                           424 => 269,
                           535 => 270,
                           885 => 271,
                           1061 => 272,
                           1166 => 273,
                           1246 => 274,
                           1358 => 275,
                           1375 => 276,
                           1613 => 277,
                           1848 => 278,
                           783 => 279,
                           365 => 280,
                           381 => 281,
                           760 => 282,
                           1112 => 283,
                           1149 => 284,
                           1659 => 285,
                           1908 => 286,
                           2107 => 287,
                           2108 => 288
                          }

CSV.foreach("data.csv", :headers => true) do |impression|
  #if impression["type"] == "Catalog Impression"
  #  data = "{\"event\":\"#{impression["type"]}\",\"properties\":{\"distinct_id\":#{impression["dealer"]},\"time\":#{impression["time"]},\"token\":\"ed160c5e9a445e4b5ff4f235f98408c2\",\"Dealer\":\"#{impression["dealer"]}\",\"Catalog\":\"#{impression["catalog"]}\"}}"
  #elsif impression["type"] == "Catalog Entry Impression"
  #  data = "{\"event\":\"#{impression["type"]}\",\"properties\":{\"distinct_id\":#{impression["dealer"]},\"time\":#{impression["time"]},\"token\":\"ed160c5e9a445e4b5ff4f235f98408c2\",\"Dealer\":\"#{impression["dealer"]}\",\"Catalog\":\"#{impression["catalog"]}\",\"Entry\":\"#{impression["entry"]}\"}}"
  #end
  #if impression["type"] == "Banner Impression"
  #  data = "{\"event\":\"#{impression["type"]}\",\"properties\":{\"distinct_id\":#{impression["dealer"]},\"time\":#{impression["time"]},\"token\":\"ed160c5e9a445e4b5ff4f235f98408c2\",\"Dealer\":\"#{impression["dealer"]}\",\"Promotion\":\"#{impression["promotion"]}\"}}"
  #elsif impression["type"] == "Banner Click"
  #  data = "{\"event\":\"#{impression["type"]}\",\"properties\":{\"distinct_id\":#{impression["dealer"]},\"time\":#{impression["time"]},\"token\":\"ed160c5e9a445e4b5ff4f235f98408c2\",\"Dealer\":\"#{impression["dealer"]}\",\"Promotion\":\"#{impression["promotion"]}\"}}"
  #end
  #puts `curl -s 'http://api.mixpanel.com/import/?api_key=5961d11441c26e42167f87cd896f24c3&data=#{Base64.encode64(data).gsub(/\n/,"")}'`
end
